[changelog]
header = """
# Changelog
"""

body = """
{% if version %}\
    ## [[{{ version | trim_start_matches(pat="v") }}]\
        {% if previous %}\
            {% if previous.version%}(https://github.com/hoodie/icalendar-rs/compare/\
                {{ previous.version }}...{{ version }}\
            ){% endif %}\
        {% endif %}] â€“ {{ timestamp | date(format="%Y-%m-%d") }}\
{% else %}
    ## [unreleased]
{% endif %}

{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim }}
    {% for commit in commits
    | filter(attribute="scope")
    | sort(attribute="scope") %}
        - *({{commit.scope}})*{% if commit.breaking %} [**breaking**]{% endif %} \
            {{ commit.message }} ([{{ commit.id | truncate(length=7, end="") }}]({{ commit.id }}))\
            {% for footer in commit.footers -%}\
                , *{{ footer.token }}{{ footer.separator }}{{ footer.value }}*\
            {% endfor %}\
    {%- endfor -%}
    {% raw %}\n{% endraw %}\
    {%- for commit in commits %}
        {%- if commit.scope -%}
        {% else %}
            - {% if commit.breaking %} [**breaking**]{% endif %} \
                {{ commit.message }} ([{{ commit.id | truncate(length=7, end="") }}]({{ commit.id }}))\
                {% for footer in commit.footers -%}\
                  , *{{ footer.token }}{{ footer.separator }}{{ footer.value }}*\
                {% endfor %}\
        {% endif -%}
    {% endfor -%}
{% endfor %}\n

"""
trim = true

[git]
conventional_commits = true
filter_unconventional = true
split_commits = false
commit_parsers = [
    { message = "^feat", group = "Features" },
    { message = "^fix\\(deps\\): Dependency updates", skip = true},
    { message = "^fix", group = "Bug Fixes" },
    { message = "^doc", group = "Documentation" },
    { message = "^perf", group = "Performance" },
    # { message = "^refactor", group = "Refactor"},
    # { message = "^style", group = "Styling"},
    # { message = "^test", group = "Testing"},
]
filter_commits = true
commit_preprocessors = []
protect_breaking_commits = true
tag_pattern = "v[0-9]*"
ignore_tags = ""
topo_order = false
sort_commits = "oldest"
link_parsers = [
    { pattern = "#(\\d+)", href = "https://github.com/hoodie/icalendar-rs/issues/$1" },
]
